# 1. Worker 数：设置为你机器的 CPU 核心数
# 比如你的 Mini-Seastar 用了 4 个线程，这里就设为 4，保证 CPU 资源对等
worker_processes 16; 

# 2. 绑定 CPU 亲和性（可选，极致优化）
# worker_cpu_affinity 0001 0010 0100 1000;

events {
    # 每个 Worker 允许的最大连接数，必须足够大以防瓶颈
    worker_connections 65535;
    use epoll;
    # 开启 multi_accept 可以让 worker 一次 accept 多个连接
    multi_accept on; 
}

http {
    # 3. 关键优化：零拷贝与包优化
    sendfile on;
    tcp_nopush on;  # 在发送响应头时防止小包发送
    tcp_nodelay on; # 禁用 Nagle 算法，降低延迟

    # 4. 关键优化：关闭磁盘日志
    access_log off; 
    error_log /dev/null crit; # 甚至把错误日志也关掉

    # 长连接设置
    keepalive_timeout 65;
    keepalive_requests 100000;

    server {
        listen 8080 reuseport; # reuseport 是 Linux 3.9+ 的神技，允许多个线程绑定同一端口，性能极大提升
        
        location / {
            # 5. 纯内存响应：不读磁盘文件
            return 200 "Hello World!"; 
            # 指定内容类型，避免浏览器猜测
            add_header Content-Type text/plain;
        }
    }
}